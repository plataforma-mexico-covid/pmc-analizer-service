/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.3/userguide/java_library_plugin.html
 */
buildscript {
	ext {
		springBootVersion = '2.0.2.RELEASE'
	}
	repositories {
		maven {
	      url "https://plugins.gradle.org/m2/"
	    }
	}
	dependencies {
		classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
		classpath('se.transmode.gradle:gradle-docker:1.2')
		classpath('net.ltgt.gradle:gradle-apt-plugin:0.21')
	}
}

apply plugin: 'java'
apply plugin: 'groovy'
apply plugin: 'eclipse'
apply plugin: 'application'
apply plugin: 'org.springframework.boot'
apply plugin: 'io.spring.dependency-management'
apply plugin: 'docker'

group = 'mx.mexicocovid19.plataforma.pmc.analizer'
sourceCompatibility = 1.8

mainClassName = 'mx.mexicocovid19.plataforma.pmc.analizer.PlataformaAnalizerApp'

repositories {
    jcenter()
    mavenCentral()
}

sourceSets {
	test {
		java { srcDirs = [] }
		groovy { srcDirs += ['src/test/java', 'src/test/groovy'] }
	}
}

dependencies {
	[
        'org.springframework.boot:spring-boot-starter-actuator',
		'org.springframework.boot:spring-boot-starter-data-jpa',
		'org.springframework.boot:spring-boot-starter-web',
		'org.springframework.boot:spring-boot-starter-tomcat',
		'org.springframework.boot:spring-boot-starter-log4j2',
		'org.springframework.boot:spring-boot-starter-mail',
		'org.springframework.boot:spring-boot-starter-security',
	    
		'io.springfox:springfox-swagger2:2.4.0',
	    'io.springfox:springfox-swagger-ui:2.4.0',
	
		"org.apache.poi:poi:3.17",
		"org.apache.poi:poi-ooxml:3.17",
		"org.apache.xmlbeans:xmlbeans:2.3.0",
	
		'org.apache.velocity:velocity:1.7',
		'javax.mail:javax.mail-api:1.6.2',

		'org.ahocorasick:ahocorasick:0.4.0',
		'org.owasp.encoder:encoder:1.2.2',
		'com.google.code.gson:gson:2.8.6',
	
		'com.h2database:h2',
		'org.mariadb.jdbc:mariadb-java-client:2.1.0',
		'mysql:mysql-connector-java:6.0.6'
    ].each { dep ->
        compile(dep) {
            exclude module: "spring-boot-starter-logging"
            exclude module: "logback-classic"
        }
    }
    
    compileOnly 'org.projectlombok:lombok:1.16.10'
	annotationProcessor "org.projectlombok:lombok:1.16.10"
	
	testCompile('org.springframework.boot:spring-boot-starter-test')
	testCompile 'org.codehaus.groovy:groovy-all:2.4.4'
    testCompile 'org.spockframework:spock-core:1.2-groovy-2.4'
    testCompile 'org.spockframework:spock-spring:1.2-groovy-2.4'
    
}

task copyJar(type: Copy) {
	dependsOn   'build'
	from        "build/libs/pmc-analizer-${project.version}.jar"
	into        'build/docker'
}

task buildDocker(type: Docker, dependsOn: copyJar) {
	baseImage "java:8"
	runCommand("mkdir pmc-analizer")
	addFile("pmc-analizer-${project.version}.jar","pmc-analizer/")
	workingDir("/pmc-analizer")
	runCommand("unzip -q pmc-analizer-${project.version}.jar")
	entryPoint(["java","-Xms128m","-Xmx1024m","-cp", "/pmc-analizer-config:.","org.springframework.boot.loader.JarLauncher"])
}
